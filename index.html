<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶¨‡¶ø‡¶∏‡¶Æ‡¶ø‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶≠‡¶ø‡¶≤‡¶æ - ‡¶∏‡¶†‡¶ø‡¶ï ‡¶¨‡¶ø‡¶≤ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü‡¶∞</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { font-family: 'Arial', sans-serif; background-color: #f0f2f5; padding: 10px; margin: 0; }
        .container { max-width: 450px; margin: auto; background: #fff; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); border-top: 6px solid #2e7d32; }
        .config-section { background: #e8f5e9; padding: 15px; border-bottom: 1px solid #ddd; font-size: 13px; }
        .main-content { padding: 20px; }
        .header { text-align: center; border-bottom: 1px dashed #000; padding-bottom: 10px; margin-bottom: 15px; }
        .header h1 { margin: 0; font-size: 24px; color: #1b5e20; }
        
        input, select { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 6px; font-size: 15px; box-sizing: border-box; }
        label { font-weight: bold; font-size: 13px; display: block; margin-top: 10px; }
        
        .btn-group { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 15px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .calc-btn { background: #2e7d32; color: white; }
        .download-btn { background: #1976d2; color: white; display: none; }

        .result-area { margin-top: 20px; padding: 15px; background: white; border: 2px solid #eee; border-radius: 8px; }
        .res-row { display: flex; justify-content: space-between; font-size: 15px; margin-bottom: 6px; }
        .total-box { background: #1b5e20; color: white; padding: 12px; border-radius: 8px; margin-top: 15px; display: flex; justify-content: space-between; font-weight: bold; font-size: 18px; }
        
        .footer-sign { margin-top: 35px; display: flex; justify-content: space-between; }
        .sign-line { border-top: 1px solid #000; width: 110px; text-align: center; font-size: 12px; font-weight: bold; }
        .thanks-note { text-align: center; font-size: 15px; font-weight: bold; margin-top: 25px; color: #1b5e20; border-top: 1px dashed #ccc; padding-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div class="config-section" id="config">
        <strong>‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ (‡¶Æ‡¶æ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏):</strong>
        <input type="text" id="tenantListInput" value="‡¶¶‡ßã‡¶ï‡¶æ‡¶®-‡ß¶‡ßß, ‡¶¶‡ßã‡¶ï‡¶æ‡¶®-‡ß¶‡ß®, ‡¶Æ‡¶ø‡¶≤‡¶®, ‡¶®‡ßÅ‡¶∞ ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ, ‡¶∂‡¶æ‡¶Æ‡¶ø‡¶Æ ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ">
    </div>

    <div class="main-content" id="printArea">
        <div class="header">
            <div style="font-size: 35px;">üè†</div>
            <h1>‡¶¨‡¶ø‡¶∏‡¶Æ‡¶ø‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶≠‡¶ø‡¶≤‡¶æ</h1>
            <p>‡ß≠‡ß™‡ß¶/‡ßß ‡¶ó‡¶æ‡¶õ‡¶æ ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶™‡ßÅ‡¶∞ ‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶ ‡¶∞‡ßã‡¶°, ‡¶ó‡¶æ‡¶ú‡ßÄ‡¶™‡ßÅ‡¶∞‡•§</p>
        </div>

        <label>‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ ‡¶ì ‡¶´‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ü:</label>
        <select id="tenantName"></select>
        <input type="text" id="flatNo" placeholder="‡¶´‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ü/‡¶¶‡ßã‡¶ï‡¶æ‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
        
        <label>‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶∏:</label>
        <select id="billMonth">
            <option>‡¶ú‡¶æ‡¶®‡ßÅ‡ßü‡¶æ‡¶∞‡¶ø</option><option>‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡ßü‡¶æ‡¶∞‡¶ø</option><option>‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö</option><option>‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤</option>
            <option>‡¶Æ‡ßá</option><option>‡¶ú‡ßÅ‡¶®</option><option>‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á</option><option>‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü</option>
            <option>‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá‡¶Æ‡ßç‡¶¨‡¶∞</option><option>‡¶Ö‡¶ï‡ßç‡¶ü‡ßã‡¶¨‡¶∞</option><option>‡¶®‡¶≠‡ßá‡¶Æ‡ßç‡¶¨‡¶∞</option><option>‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞</option>
        </select>

        <label>‡¶∞‡¶ø‡¶°‡¶ø‡¶Ç ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨:</label>
        <input type="number" id="present" placeholder="‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∞‡¶ø‡¶°‡¶ø‡¶Ç">
        <input type="number" id="previous" placeholder="‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶∞‡¶ø‡¶°‡¶ø‡¶Ç">
        <input type="number" id="arrear" value="0" placeholder="‡¶¨‡¶ï‡ßá‡ßü‡¶æ ‡¶ü‡¶æ‡¶ï‡¶æ">

        <div class="btn-group">
            <button class="calc-btn" onclick="calculateBill()">‡¶∏‡¶†‡¶ø‡¶ï ‡¶¨‡¶ø‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <button class="download-btn" id="dBtn" onclick="downloadImage()">‡¶õ‡¶¨‡¶ø ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</button>
        </div>

        <div id="output" class="result-area" style="display:none;">
            <div style="text-align:center; border-bottom: 2px solid #2e7d32; padding-bottom: 5px; margin-bottom: 10px;">
                <strong style="font-size: 18px; color: #1b5e20;">‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡ßÅ‡ßé ‡¶¨‡¶ø‡¶≤ ‡¶∞‡¶∏‡¶ø‡¶¶</strong><br>
                <span>‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶∏: <span id="resMonth"></span> <span id="resYear"></span></span>
            </div>
            
            <div class="res-row" style="font-size: 12px; color: #666;">
                <span>ID: #<span id="receiptNo"></span></span>
                <span>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: <span id="resDate"></span></span>
            </div>

            <div class="res-row"><span>‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ:</span> <strong id="resName"></strong></div>
            <div class="res-row"><span>‡¶®‡¶Ç:</span> <strong id="resFlat"></strong></div>
            <hr>
            <div class="res-row"><span>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∞‡¶ø‡¶°‡¶ø‡¶Ç:</span> <span id="resPres"></span></div>
            <div class="res-row"><span>‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶∞‡¶ø‡¶°‡¶ø‡¶Ç:</span> <span id="resPrev"></span></div>
            <div class="res-row" style="font-weight:bold;"><span>‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡ßÉ‡¶§ ‡¶á‡¶â‡¶®‡¶ø‡¶ü:</span> <span id="usedUnits"></span></div>
            <hr>
            <div class="res-row"><span>‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡ßÅ‡ßé ‡¶¨‡¶ø‡¶≤ (‡¶ß‡¶æ‡¶™ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ):</span> <span id="energy"></span></div>
            <div class="res-row"><span>‡¶°‡¶ø‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶ì ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú:</span> <span>‡ß¨‡ß¶.‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</span></div>
            <div class="res-row"><span>‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü (‡ß´%):</span> <span id="vat"></span></div>
            <div class="res-row" style="color:red;"><span>‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶¨‡¶ï‡ßá‡ßü‡¶æ:</span> <span id="resArrear"></span></div>
            
            <div class="total-box">
                <span>‡¶Æ‡ßã‡¶ü ‡¶™‡ßç‡¶∞‡¶¶‡ßá‡ßü ‡¶¨‡¶ø‡¶≤:</span>
                <span id="total"></span>
            </div>
            
            <div class="footer-sign">
                <div class="sign-line">‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞</div>
                <div class="sign-line">‡¶Æ‡¶æ‡¶≤‡¶ø‡¶ï‡ßá‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞</div>
            </div>
            <div class="thanks-note">‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶‡¶æ‡¶®‡ßç‡¶§‡ßá: ‡¶¨‡¶ø‡¶∏‡¶Æ‡¶ø‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶≠‡¶ø‡¶≤‡¶æ</div>
        </div>
    </div>
</div>

<script>
    function updateDropdown() {
        const input = document.getElementById('tenantListInput').value;
        const names = input.split(',');
        const select = document.getElementById('tenantName');
        select.innerHTML = "";
        names.forEach(name => {
            if(name.trim() !== ""){
                let opt = document.createElement('option');
                opt.value = name.trim();
                opt.innerHTML = name.trim();
                select.appendChild(opt);
            }
        });
        localStorage.setItem('tenantList', input);
    }

    window.onload = function() {
        const saved = localStorage.getItem('tenantList');
        if(saved) document.getElementById('tenantListInput').value = saved;
        updateDropdown();
    };

    document.getElementById('tenantListInput').addEventListener('input', updateDropdown);

    function toBanglaNum(num) {
        const banglaDigits = ['‡ß¶', '‡ßß', '‡ß®', '‡ß©', '‡ß™', '‡ß´', '‡ß¨', '‡ß≠', '‡ßÆ', '‡ßØ'];
        return num.toString().replace(/\d/g, d => banglaDigits[d]);
    }

    function calculateBill() {
        let pres = parseFloat(document.getElementById('present').value);
        let prev = parseFloat(document.getElementById('previous').value);
        let arrear = parseFloat(document.getElementById('arrear').value) || 0;
        
        if (isNaN(pres) || isNaN(prev) || pres < prev) {
            alert("‡¶∏‡¶†‡¶ø‡¶ï ‡¶∞‡¶ø‡¶°‡¶ø‡¶Ç ‡¶¶‡¶ø‡¶®"); return;
        }

        let units = pres - prev;
        let energy = 0;

        // ‡¶∏‡¶∞‡¶ï‡¶æ‡¶∞‡¶ø ‡¶∏‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶ß‡¶æ‡¶™‡ßá ‡¶ß‡¶æ‡¶™‡ßá ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ (Slab Wise Calculation)
        if (units <= 75) {
            energy = units * 5.26;
        } else if (units <= 200) {
            energy = (75 * 5.26) + ((units - 75) * 7.20);
        } else if (units <= 300) {
            energy = (75 * 5.26) + (125 * 7.20) + ((units - 200) * 7.59);
        } else if (units <= 400) {
            energy = (75 * 5.26) + (125 * 7.20) + (100 * 7.59) + ((units - 300) * 8.02);
        } else if (units <= 600) {
            energy = (75 * 5.26) + (125 * 7.20) + (100 * 7.59) + (100 * 8.02) + ((units - 400) * 12.67);
        } else {
            energy = (75 * 5.26) + (125 * 7.20) + (100 * 7.59) + (100 * 8.02) + (200 * 12.67) + ((units - 600) * 14.61);
        }

        let vat = (energy + 42) * 0.05;
        let grandTotal = energy + 42 + vat + arrear;

        const now = new Date();
        document.getElementById('resName').innerText = document.getElementById('tenantName').value;
        document.getElementById('resFlat').innerText = document.getElementById('flatNo').value;
        document.getElementById('resMonth').innerText = document.getElementById('billMonth').value;
        document.getElementById('resYear').innerText = toBanglaNum(now.getFullYear());
        document.getElementById('resDate').innerText = toBanglaNum(now.toLocaleDateString('bn-BD'));
        document.getElementById('receiptNo').innerText = toBanglaNum(Math.floor(now.getTime()/10000).toString().slice(-4));
        
        document.getElementById('resPres').innerText = toBanglaNum(pres) + " ‡¶á‡¶â‡¶®‡¶ø‡¶ü";
        document.getElementById('resPrev').innerText = toBanglaNum(prev) + " ‡¶á‡¶â‡¶®‡¶ø‡¶ü";
        document.getElementById('usedUnits').innerText = toBanglaNum(units) + " ‡¶á‡¶â‡¶®‡¶ø‡¶ü";
        document.getElementById('energy').innerText = toBanglaNum(energy.toFixed(2)) + " ‡¶ü‡¶æ‡¶ï‡¶æ";
        document.getElementById('vat').innerText = toBanglaNum(vat.toFixed(2)) + " ‡¶ü‡¶æ‡¶ï‡¶æ";
        document.getElementById('resArrear').innerText = toBanglaNum(arrear) + " ‡¶ü‡¶æ‡¶ï‡¶æ";
        document.getElementById('total').innerText = toBanglaNum(Math.round(grandTotal)) + " ‡¶ü‡¶æ‡¶ï‡¶æ";

        document.getElementById('output').style.display = 'block';
        document.getElementById('dBtn').style.display = 'block';
    }

    function downloadImage() {
        const element = document.getElementById('printArea');
        const config = document.getElementById('config');
        const btns = document.querySelectorAll('.btn-group');
        const labels = element.querySelectorAll('label, input, select');

        config.style.display = 'none';
        btns.forEach(b => b.style.display = 'none');
        labels.forEach(l => l.style.display = 'none');

        html2canvas(element, { scale: 3 }).then(canvas => {
            const link = document.createElement('a');
            link.download = '‡¶∞‡¶∏‡¶ø‡¶¶-' + document.getElementById('tenantName').value + '.png';
            link.href = canvas.toDataURL();
            link.click();
            config.style.display = 'block';
            btns.forEach(b => b.style.display = 'flex');
            labels.forEach(l => l.style.display = 'block');
        });
    }
</script>

</body>
</html>
