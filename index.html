<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶¨‡¶ø‡¶∏‡¶Æ‡¶ø‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶≠‡¶ø‡¶≤‡¶æ - ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü ‡¶∞‡¶∏‡¶ø‡¶¶</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { font-family: 'Arial', sans-serif; background-color: #f0f2f5; padding: 10px; margin: 0; }
        .container { max-width: 450px; margin: auto; background: #fff; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); overflow: hidden; border-top: 6px solid #2e7d32; }
        .config-section { background: #e8f5e9; padding: 15px; border-bottom: 1px solid #ddd; font-size: 13px; }
        .main-content { padding: 20px; }
        .header { text-align: center; border-bottom: 1px dashed #000; padding-bottom: 10px; margin-bottom: 15px; }
        .header h1 { margin: 0; font-size: 24px; color: #1b5e20; }
        .header p { margin: 2px 0; font-size: 13px; color: #444; }
        
        label { font-weight: bold; font-size: 13px; display: block; margin-top: 10px; color: #333; }
        input, select { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 15px; }
        
        .btn-group { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 15px; }
        button { flex: 1; min-width: 100px; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 14px; }
        .calc-btn { background: #2e7d32; color: white; }
        .download-btn { background: #1976d2; color: white; display: none; }
        .print-btn { background: #333; color: white; display: none; }

        .result-area { margin-top: 20px; padding: 15px; background: white; border: 1px solid #eee; border-radius: 8px; }
        .res-row { display: flex; justify-content: space-between; font-size: 15px; margin-bottom: 6px; border-bottom: 1px solid #f9f9f9; }
        .total { font-size: 20px; font-weight: bold; color: #d32f2f; border-top: 2px solid #000; padding-top: 8px; margin-top: 10px; }
        .footer-sign { margin-top: 30px; display: flex; justify-content: space-between; padding-top: 20px; }
        .sign-line { border-top: 1px solid #000; width: 110px; text-align: center; font-size: 12px; font-weight: bold; }
        .thanks-note { text-align: center; font-size: 14px; font-weight: bold; margin-top: 20px; color: #1b5e20; border-top: 1px dashed #ccc; padding-top: 10px; }

        @media print {
            .config-section, input, select, .btn-group, label { display: none !important; }
            body { background: white; }
            .container { box-shadow: none; border: none; width: 100%; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="config-section" id="config">
        <strong>‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ (‡¶Æ‡¶æ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏):</strong><br>
        <small>‡¶®‡¶æ‡¶Æ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶ï‡¶Æ‡¶æ ‡¶¶‡¶ø‡ßü‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡ßç‡¶™‡ßá‡¶∏ ‡¶¶‡¶ø‡¶®:</small>
        <input type="text" id="tenantListInput" value="‡¶Ü‡¶¨‡ßç‡¶¶‡ßÅ‡¶∞ ‡¶∞‡¶π‡¶Æ‡¶æ‡¶®, ‡¶∂‡¶∞‡¶ø‡¶´ ‡¶Æ‡¶ø‡ßü‡¶æ, ‡¶¶‡ßã‡¶ï‡¶æ‡¶®-‡ßß">
    </div>

    <div class="main-content" id="printArea">
        <div class="header">
            <div style="font-size: 30px;">üè†</div>
            <h1>‡¶¨‡¶ø‡¶∏‡¶Æ‡¶ø‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶≠‡¶ø‡¶≤‡¶æ</h1>
            <p>‡ß≠‡ß™‡ß¶/‡ßß ‡¶ó‡¶æ‡¶õ‡¶æ ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶™‡ßÅ‡¶∞ ‡¶Æ‡¶∏‡¶ú‡¶ø‡¶¶ ‡¶∞‡ßã‡¶°, ‡¶ó‡¶æ‡¶ú‡ßÄ‡¶™‡ßÅ‡¶∞‡•§</p>
            <p>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤: ‡ß¶‡ßß‡ß≠‡ßß‡ß´‡ß¨‡ß´‡ß©‡ß¶‡ß´‡ß¨</p>
        </div>

        <label>‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ:</label>
        <select id="tenantName"></select>

        <label>‡¶¶‡ßã‡¶ï‡¶æ‡¶®/‡¶´‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ü ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞:</label>
        <input type="text" id="flatNo" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶¶‡ßã‡¶ï‡¶æ‡¶®-‡ßß‡ß¶">

        <label>‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ:</label>
        <select id="billMonth">
            <option>‡¶ú‡¶æ‡¶®‡ßÅ‡ßü‡¶æ‡¶∞‡¶ø</option><option>‡¶´‡ßá‡¶¨‡ßç‡¶∞‡ßÅ‡ßü‡¶æ‡¶∞‡¶ø</option><option>‡¶Æ‡¶æ‡¶∞‡ßç‡¶ö</option><option>‡¶è‡¶™‡ßç‡¶∞‡¶ø‡¶≤</option>
            <option>‡¶Æ‡ßá</option><option>‡¶ú‡ßÅ‡¶®</option><option>‡¶ú‡ßÅ‡¶≤‡¶æ‡¶á</option><option>‡¶Ü‡¶ó‡¶∏‡ßç‡¶ü</option>
            <option>‡¶∏‡ßá‡¶™‡ßç‡¶ü‡ßá‡¶Æ‡ßç‡¶¨‡¶∞</option><option>‡¶Ö‡¶ï‡ßç‡¶ü‡ßã‡¶¨‡¶∞</option><option>‡¶®‡¶≠‡ßá‡¶Æ‡ßç‡¶¨‡¶∞</option><option>‡¶°‡¶ø‡¶∏‡ßá‡¶Æ‡ßç‡¶¨‡¶∞</option>
        </select>

        <label>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∞‡¶ø‡¶°‡¶ø‡¶Ç:</label>
        <input type="number" id="present">

        <label>‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶∞‡¶ø‡¶°‡¶ø‡¶Ç:</label>
        <input type="number" id="previous">

        <label>‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶¨‡¶ï‡ßá‡ßü‡¶æ (‡¶ü‡¶æ‡¶ï‡¶æ):</label>
        <input type="number" id="arrear" value="0">

        <div class="btn-group">
            <button class="calc-btn" onclick="calculateBill()">‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ì ‡¶∞‡¶∏‡¶ø‡¶¶ ‡¶§‡ßà‡¶∞‡¶ø</button>
            <button class="download-btn" id="dBtn" onclick="downloadImage()">‡¶õ‡¶¨‡¶ø ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</button>
            <button class="print-btn" id="pBtn" onclick="window.print()">‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü</button>
        </div>

        <div id="output" class="result-area" style="display:none;">
            <div style="text-align:center;">
                <strong style="font-size: 16px;">‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡ßÅ‡ßé ‡¶¨‡¶ø‡¶≤ ‡¶∞‡¶∏‡¶ø‡¶¶ - <span id="resMonth"></span> <span id="resYear"></span></strong><br>
                <small>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: <span id="resDate"></span></small>
            </div>
            <br>
            <div class="res-row"><span>‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ:</span> <strong id="resName"></strong></div>
            <div class="res-row"><span>‡¶¶‡ßã‡¶ï‡¶æ‡¶®/‡¶´‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ü:</span> <span id="resFlat"></span></div>
            <hr>
            <div class="res-row"><span>‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡ßÉ‡¶§ ‡¶á‡¶â‡¶®‡¶ø‡¶ü:</span> <strong id="usedUnits">‡ß¶</strong></div>
            <div class="res-row"><span>‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡ßÅ‡ßé ‡¶¨‡¶ø‡¶≤:</span> <span id="energy">‡ß¶</span></div>
            <div class="res-row"><span>‡¶°‡¶ø‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶ì ‡¶Æ‡¶ø‡¶ü‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú:</span> <span>‡ß¨‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</span></div>
            <div class="res-row"><span>‡¶≠‡ßç‡¶Ø‡¶æ‡¶ü (‡ß´%):</span> <span id="vat">‡ß¶</span></div>
            <div class="res-row"><span>‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶¨‡¶ï‡ßá‡ßü‡¶æ:</span> <span id="resArrear">‡ß¶</span></div>
            <div class="res-row total"><span>‡¶Æ‡ßã‡¶ü ‡¶™‡ßç‡¶∞‡¶¶‡ßá‡ßü ‡¶¨‡¶ø‡¶≤:</span> <span id="total">‡ß¶</span> ‡¶ü‡¶æ‡¶ï‡¶æ</div>
            
            <div class="footer-sign">
                <div class="sign-line">‡¶≠‡¶æ‡ßú‡¶æ‡¶ü‡¶ø‡ßü‡¶æ‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞</div>
                <div class="sign-line">‡¶Æ‡¶æ‡¶≤‡¶ø‡¶ï‡ßá‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ï‡ßç‡¶∑‡¶∞</div>
            </div>
            
            <div class="thanks-note">‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶‡¶æ‡¶®‡ßç‡¶§‡ßá: ‡¶¨‡¶ø‡¶∏‡¶Æ‡¶ø‡¶≤‡ßç‡¶≤‡¶æ‡¶π ‡¶≠‡¶ø‡¶≤‡¶æ</div>
        </div>
    </div>
</div>

<script>
    function updateDropdown() {
        const inputField = document.getElementById('tenantListInput');
        const input = inputField.value;
        const names = input.split(',');
        const select = document.getElementById('tenantName');
        
        select.innerHTML = "";
        names.forEach(name => {
            if(name.trim() !== ""){
                let opt = document.createElement('option');
                opt.value = name.trim();
                opt.innerHTML = name.trim();
                select.appendChild(opt);
            }
        });
        localStorage.setItem('tenantList', input);
    }

    window.onload = function() {
        const saved = localStorage.getItem('tenantList');
        if(saved) {
            document.getElementById('tenantListInput').value = saved;
        }
        updateDropdown();
    };

    // ‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá‡¶á ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶¨‡ßá
    document.getElementById('tenantListInput').addEventListener('input', updateDropdown);

    function toBanglaNum(num) {
        const banglaDigits = ['‡ß¶', '‡ßß', '‡ß®', '‡ß©', '‡ß™', '‡ß´', '‡ß¨', '‡ß≠', '‡ßÆ', '‡ßØ'];
        return num.toString().replace(/\d/g, d => banglaDigits[d]);
    }

    function calculateBill() {
        let pres = parseFloat(document.getElementById('present').value);
        let prev = parseFloat(document.getElementById('previous').value);
        let arrear = parseFloat(document.getElementById('arrear').value) || 0;
        
        if (isNaN(pres) || isNaN(prev) || pres < prev) {
            alert("‡¶∏‡¶†‡¶ø‡¶ï ‡¶∞‡¶ø‡¶°‡¶ø‡¶Ç ‡¶¶‡¶ø‡¶®"); return;
        }

        let units = pres - prev;
        let energy = 0;
        if (units <= 50) energy = units * 4.63;
        else if (units <= 75) energy = units * 5.26;
        else if (units <= 200) energy = units * 7.20;
        else if (units <= 300) energy = units * 7.59;
        else if (units <= 400) energy = units * 8.02;
        else if (units <= 600) energy = units * 12.67;
        else energy = units * 14.61;

        let vat = (energy + 60) * 0.05;
        let grandTotal = energy + 60 + vat + arrear;

        const now = new Date();
        document.getElementById('resName').innerText = document.getElementById('tenantName').value;
        document.getElementById('resFlat').innerText = document.getElementById('flatNo').value;
        document.getElementById('resMonth').innerText = document.getElementById('billMonth').value;
        document.getElementById('resYear').innerText = toBanglaNum(now.getFullYear());
        document.getElementById('usedUnits').innerText = toBanglaNum(units);
        document.getElementById('energy').innerText = toBanglaNum(energy.toFixed(2));
        document.getElementById('vat').innerText = toBanglaNum(vat.toFixed(2));
        document.getElementById('resArrear').innerText = toBanglaNum(arrear);
        document.getElementById('total').innerText = toBanglaNum(Math.round(grandTotal));
        document.getElementById('resDate').innerText = toBanglaNum(now.toLocaleDateString('bn-BD'));

        document.getElementById('output').style.display = 'block';
        document.getElementById('dBtn').style.display = 'block';
        document.getElementById('pBtn').style.display = 'block';
    }

    function downloadImage() {
        const element = document.getElementById('printArea');
        const config = document.getElementById('config');
        const btns = document.querySelectorAll('.btn-group');
        const labels = element.querySelectorAll('label, input, select');

        config.style.display = 'none';
        btns.forEach(b => b.style.display = 'none');
        labels.forEach(l => l.style.display = 'none');

        html2canvas(element, { scale: 3 }).then(canvas => {
            const link = document.createElement('a');
            link.download = '‡¶∞‡¶∏‡¶ø‡¶¶-' + document.getElementById('tenantName').value + '.png';
            link.href = canvas.toDataURL();
            link.click();
            
            config.style.display = 'block';
            btns.forEach(b => b.style.display = 'flex');
            labels.forEach(l => l.style.display = 'block');
            document.getElementById('dBtn').style.display = 'block';
            document.getElementById('pBtn').style.display = 'block';
        });
    }
</script>

</body>
</html>
